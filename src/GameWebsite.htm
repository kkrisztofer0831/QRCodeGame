<!DOCTYPE html>
<html lang="hu">

<head>
    <title>QR Code Game</title>
    <meta charset="UTF-8">
    <style>
        table {          
            margin-left: auto;
            margin-right: auto;
            border: 1px solid black;
            width: 60%;
        }
        td{
            border: 1px solid black;
            border-collapse: collapse;
            text-align: center;
        }
    </style>
</head>

<body>
    <svg width="1000" height="550">
        <!--
            //"location00" : [ 090 , 310 ], //Kezdo pozicio
            //"location01" : [ 600 , 225 ],
            //"location02" : [ 400 , 095 ],
            //"location03" : [ 630 , 425 ],
            //"location04" : [ 830 , 200 ],
            //"location05" : [ 135 , 225 ],

        -->
        <rect id="I_epulet"     width="200" height="175" x="20" y="20" fill="black"></rect>
        <rect id="I_epulet_bejarat"     width="60" height="30" x="90" y="195" fill="black"></rect>
        <rect id="A_epulet"     width="430" height="125" x="270" y="20" fill="black"></rect>
        <rect id="A_epulet_bejarat"     width="100" height="30" x="435" y="145" fill="black"></rect> <!--x = ref_horizontal_offset + ref_width/2 - width/2--> <!--y = ref_vertical_offset + ref_height-->
        <rect id="Aula"         width="150" height="250" x="750" y="20" fill="black"></rect>
        <rect id="fout"     width="880" height="75" x="20" y="310" fill="white" stroke="black" stroke-width="5"></rect>
        <rect id="E_epulet"     width="100" height="150" x="600" y="425" fill="black"></rect>
        <rect id="K_epulet"     width="100" height="100" x="475" y="425" fill="black"></rect>
        <rect id="random_epulet"     width="300" height="100" x="20" y="425" fill="black"></rect>

        <circle id="team01" r="15" fill="red" cx="600" cy="225"></circle>
        <circle id="team02" r="15" fill="green" cx="650" cy="225"></circle>
        <circle id="team03" r="15" fill="blue" cx="90" cy="310"></circle>

    </svg>
    <!-- <table>
        <tr>
            <td id = "csapatID" colspan="3">
                Csapat01   
            </td>
        </tr>
        <tr>
            <td id = "csapatNev">

            </td>
            <td id = "eltoltottido">

            </td>
            <td id = "pontszam">

            </td>
        </tr>
    </table> -->
    <!-- <script type="module" src="./FrontEnd.js"></script>  --> <!-- Ez CORS Policy-s hibÃ¡t dob -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.7/firebase-app.js';
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.7/firebase-database.js";

        var dom_csapatID = document.getElementById("csapatID");
        var dom_csapatNev = document.getElementById("csapatNev");
        var dom_eltoltottido = document.getElementById("eltoltottido");
        var dom_pontszam = document.getElementById("pontszam");

        // const firebaseConfig = {
        //     apiKey: "AIzaSyBWjxAGwZDJ5aOrpOA4XL9dE5r6eiv2Gcs",
        //     authDomain: "qrgame-29677.firebaseapp.com",
        //     databaseURL: "https://qrgame-29677-default-rtdb.europe-west1.firebasedatabase.app",
        //     projectId: "qrgame-29677",
        //     storageBucket: "qrgame-29677.appspot.com",
        //     messagingSenderId: "689257745448",
        //     appId: "1:689257745448:web:f3286f6aeb65d6a8f2391d",
        //     measurementId: "G-PE0JCSMN6E"
        // };

        console.log(location.hostname);
        var firebaseConfig;
        if (location.hostname === 'localhost') {
            // Point to the RTDB emulator running on localhost.
            firebaseConfig = {
                databaseURL : "http://localhost:9000?ns=qrgame-29677"
            }
            console.log("Local!");
         //   connectDatabaseEmulator(database, "localhost", 9000);
        }  else {
            console.log("Not local!");
        }

        const firebaseApp = initializeApp(firebaseConfig); 
        const db = getDatabase(firebaseApp);
        const dbRef = ref(getDatabase());

        var dom_team01 = document.getElementById("team01");
        var dom_team02 = document.getElementById("team02");
        var dom_team03 = document.getElementById("team03");

        var rtdb_team01_location = "csapatok/csapat_id_1/location"
        var rtdb_team02_location = "csapatok/csapat_id_2/location"
        var rtdb_team03_location = "csapatok/csapat_id_3/location"

        var ref_team01_location = ref(db, rtdb_team01_location);
        var ref_team02_location = ref(db, rtdb_team02_location);
        var ref_team03_location = ref(db, rtdb_team03_location);

        function updateTeamLocation(ref_field, dom_team){
            onValue(ref_field, (snapshot) => {
                const data = snapshot.val();
                switch(data) {
                    case "location00": {
                        dom_team.setAttribute("cx" , "90");
                        dom_team.setAttribute("cy" , "310");
                        break;
                    }
                    case "location01":{
                        dom_team.setAttribute("cx" , "600");
                        dom_team.setAttribute("cy" , "225");
                        break;
                    }
                    case "location02":
                    {
                        dom_team.setAttribute("cx" , "400");
                        dom_team.setAttribute("cy" , "095");
                        break;
                    }
                    case "location03":
                    {
                        dom_team.setAttribute("cx" , "630");
                        dom_team.setAttribute("cy" , "425");
                        break;
                    }
                    case "location04":
                    {
                        dom_team.setAttribute("cx" , "830");
                        dom_team.setAttribute("cy" , "200");
                        break;
                    }
                    case "location05":
                    {
                        dom_team.setAttribute("cx" , "135");
                        dom_team.setAttribute("cy" , "225");
                        break;
                    }
                    //"location00" : [ 090 , 310 ], //Kezdo pozicio
                    //"location01" : [ 600 , 225 ],
                    //"location02" : [ 400 , 095 ],
                    //"location03" : [ 630 , 425 ],
                    //"location04" : [ 830 , 200 ],
                    //"location05" : [ 135 , 225 ],
                }
            })
        }
    
    
        updateTeamLocation(ref_team01_location, dom_team01);
        updateTeamLocation(ref_team02_location, dom_team02);
        updateTeamLocation(ref_team03_location, dom_team03);
        
        // var rtdb_csapatID = "csapatok/csapat_id_1";
        // var rtdb_csapatnev = rtdb_csapatID + "/csapatnev";
        // var rtdb_eltoltott_ido = rtdb_csapatID + "/eltoltottido";
        // var rtdb_pontszam = rtdb_csapatID + "/pontszam";

        // const ref_csapatID = ref(db, rtdb_csapatID);
        // const ref_csapatnev = ref(db, rtdb_csapatnev);
        // const ref_eltoltottido = ref(db, rtdb_eltoltott_ido);
        // const ref_pontszam = ref(db, rtdb_pontszam);


        // function updateTable(ref_field, dom_element){
        //     onValue(ref_field, (snapshot) => {
        //         const data = snapshot.val();
        //         dom_element.innerHTML = data;
        //     });
        // }

        //updateTable(ref_csapatID, dom_csapatID);
        // updateTable(ref_csapatnev, dom_csapatNev);
        // updateTable(ref_eltoltottido, dom_eltoltottido);
        // updateTable(ref_pontszam, dom_pontszam);

    </script>

</body>

</html>